# WinterMemories
## 背景
- 需求：2021年计算机设计大赛要求实现一款体现冬奥会的精神的游戏
- 思路：
  - 题目有关于冬奥会，如果只涉及竞技部分会落入俗套，且无法体现出精神所在
  - 经过商讨，我们将运动员的成长经历融入到游戏中，在故事情节中穿插游戏交互
## 承担的角色
- 我秉承一颗对游戏开发热爱的心，组织了我们的参赛队伍。
- 在整个过程中，我扮演者项目负责人和主程的角色。
  - 项目负责人：我需要卡控整个项目的开发周期，以及品质保证，负责对内的管理分配和对外的沟通交涉。
  - 主程：我是队内的主程，游戏逻辑的百分之九十都由我完成。下面是我的开发流程介绍：
## 开发流程：
### 主菜单设计：
- 背景：
  - 在雪山之间运镜，体现主角的生活环境
  - 添加后期盒子，在屏幕上产生雪花效果
- 开始游戏btn：
    - 使用saveGame存了玩家玩到哪一关，开始游戏会恢复玩家的当前进度。
- 设置btn
  - 蓝图实现调整游戏的声音，游戏的画面质量，高度雾，抗锯齿，亮度
- 按键控制btn
  - 通过对UInputSettings类的修改，实现了按键的绑定解绑
- 退出游戏btn
  - 命令行指令quit
### 主场景：主角的家
- 这是贯穿整个游戏的level，玩家以游客视角在这个level中按顺序探索物品，开启交互关卡
- 每一关通关会设置gameinstance的下一关bool为true，从而触发下一关开启
- 遇到的问题：物体交互时在场景的物体太小，无法看到物品细节（这可是美工辛苦做的），以及相关的情节介绍。
  - 解决方法：模仿密室逃脱类游戏，在交互时，将控制权转移到物体上，关闭物体的碰撞，将他移动到摄像机的前方，通过上下左右控制物体的旋转查看细节，显示文字和按键开启游戏关卡
### 第一关：冬奥小镇
- 通过运镜和字幕，为玩家介绍石头镇的人文和堆冬季运动的重视。
- 将玩家带入情景。
### 第二关：初来乍到
- 主角第一次尝试滑冰运动，旨在教玩家熟悉操作
- 遇到的问题：玩家需要躲避随机移动的AI，完成滑冰练习。但如果AI仅仅随机运动，玩家可能不需要任何操作就能通过本关卡（地图较大，随机移动可能永远碰不到玩家），如何需要增大碰撞玩家的概率。
  - 优化方案1：增加AI数量，减小滑冰场面积——产生新的问题：性能消耗变大，进入关卡卡顿。
  - 优化方法2：Ai每次运动会获取到玩家的location，然后根据location和一个半径R，获取其中的随机点，moveto这个随机点。
### 第三关：体能训练
- 一个运动员最基本的要求就是有一个良好的体格，在生活中我是学院足球队成员，对于耐力跑和折返跑特别熟悉，于是将他做到游戏中。
- 光是跑圈如何体现耐力，或者增加游戏的可玩性？
  - 添加AI来增加竞技感。让AI固定路线移动 ，由 设置在线上（运动速度和方向和直接设置好不能匹配）变成追随 线上移动的物体（避免了AI不丝滑的运动）
  - 玩家需要快速按F键来让运动员跑起来，随着时间的推移耐力条下降的越来越快，就需要玩家更加尽力快速的按F键。
  - 为体现更好的效果，我设置了天空球的旋转模拟日夜兼程。在后半程添加了呼吸音效，体现玩家的疲惫。
- 遇到的问题：在让我的舍友试玩的时候，他直接给我来了一个反向跑步，竟也完成了跑圈任务，那这样我设置的AI陪跑还有什么价值呢...
  - 通过了解马里奥赛车游戏，了解到他是在跑圈的不同地方放上一个监测点，当玩家到了一个监测点才会开启下一个监测点，而且监测点有方向性，只能从一边通过有效。于是我们需要判断玩家和碰撞点的相对位置，然后判断碰撞是否生效。
### 第四关：大家小家
- 每个运动员都需要长时间训练，难免对家庭少了一点关怀。我们希望体现运动员对家人的和对事业的难以抉择，突出运动员心理上的强大
- 这一关卡主要是通过对话方式体现
- 遇到的问题：如何体现对话方式？光在一个文本框里输出文字不直观体现是谁说的话
  - 构建一个结构体：包括名字，图片，对话内容，左右位置。
  - 将需要的对话放到table中，在UI中获取到table的每一行做修改
### 第五关：折返跑 && 躲避球
- 耐力训练之后也需要一些反应训练，赛场上的突发情况很多，如果遇到了韩国选手扒拉怎么办？我们需要提高运动员的敏捷度和反应能力。
- 折返跑：每次跑过一条线，再跑回来，需要在规定时间内按顺序踩到三条线。我设置了一个操作的延迟。玩家需要提前一些时间预判，模拟实际中如果踩到线才想起往回跑，身体由于惯性仍会往前冲一段，所以我们需要再跑到线之前就往回跑。这里的跑步是自动的，玩家只需要切换方向。因此这里的顺序碰撞比较简单，不需要考虑方向。
- 躲避球：雪球发射器会随机发射雪球，玩家则需要左右运动躲避这些飞来的雪球。
  - 遇到的问题：玩家如何点击一下左/右，运动的长度正好是炮的间距呢，如果太短会卡在炮之间到一个无敌的位置，如果位移太长，又有失控的感觉
  - 解决方法：参照地铁跑酷，处于简单考虑，我将运动员摆在x轴上，每次点击左/右，都向x的正/逆方向走固定长度，如果到达最左或者最右，atSide = true,将禁止继续往该方向行走
### 第六关：奥运赛场
- 这一关我们希望主角赢，所以必须由程序控制角色。使用耐力跑的AI，换成滑冰状态机。
- 遇到的问题：玩家不能控制，就应该有一个上帝视角观察，这样效果会更好，不能跟在一个AI的脑袋后面看个没完吧？
  - 解决方法：模拟电视转播奥运会：有解说，有随着运动员移动的镜头，有现场的大屏幕，以及电视机专场UI，和赛后的排行榜。
  - 可切换镜头的实现：计算AI和三个镜头的距离，选择最近的为new view target，跟随运动员旋转。
## 整体性问题
- 如何推进游戏？
  - 方案一：失败的话进度不往前推，需要反复重复（应用在训练关卡，让玩家体会训练的艰辛）
  - 方案二：脱离玩家控制，程序写好玩家胜利（应用在奥运赛场，让玩家体会功夫不负有心人的快乐）
- 版本迭代：2D转3D
  - 最初的设计为2D模式，但一直达不到想要的效果，而且大量的sprites2D让美工方面难以完成
  - 在中期权衡之后，搜集了一些3D模型，果断推翻原来的工程，转换为3D重新开发
## 项目复盘&优化
- 整个项目都是以实现功能为目的，没有考虑性能包括复杂度。现在想一想，能优化的地方还很多。
- 可以用到的设计模式
  - 在一个训练关卡需要随机发射炮弹，如果每次spawn destroy会很浪费性能，可以使用**享元模式**创建一个雪球池，存储5个就嘎嘎够用，每次射出没碰到玩家就重回雪球池，节省了一些开销，空间换时间
  - 在过场动画使用了**外观模式**，将特效，镜头序列轨道，音乐包装在一个类里统一播放停止
  - 在角色里有一个用于和屋内物体交互的组件，而不是直接在角色上写逻辑，运用**组件模式**解耦合，且不会影响character在之后关卡中的使用
  - 不同关卡的AI来自同一个父类加上**装饰器模式**，一个可以随机走路，一个可以循迹走路，比直接继承生成两个子类要灵活
- 为了让玩家按顺序跑圈，创建了很多碰撞体和判断条件。其实可以创建一个，然后改变他的位置到合适的地方，如果道路很长的话，能节省不少资源。
